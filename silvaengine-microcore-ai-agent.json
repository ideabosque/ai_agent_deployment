{
   "AWSTemplateFormatVersion": "2010-09-09",
   "Resources": {
      "SilvaEngineMicroCoreExecRole": {
         "Type": "AWS::IAM::Role",
         "Properties": {
            "AssumeRolePolicyDocument": {
               "Version": "2012-10-17",
               "Statement": [
                  {
                     "Effect": "Allow",
                     "Principal": {
                        "Service": [
                           "lambda.amazonaws.com"
                        ]
                     },
                     "Action": [
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "RoleName": "silvaengine_microcore_ai_agent_exec",
            "Path": "/",
            "Policies": [
               {
                  "PolicyName": "silvaengine_microcore_ai_agent_exec_policy",
                  "PolicyDocument": {
                     "Version": "2012-10-17",
                     "Statement": [
                        {
                           "Action": [
                              "logs:CreateLogGroup",
                              "logs:CreateLogStream",
                              "logs:PutLogEvents"
                           ],
                           "Resource": "arn:aws:logs:*:*:*",
                           "Effect": "Allow"
                        },
                        {
                           "Action": [
                              "sqs:*",
                              "s3:*",
                              "dynamodb:*",
                              "cloudwatch:*",
                              "iam:ListRoles",
                              "sns:*",
                              "lambda:*",
                              "ec2:*",
                              "cognito-idp:*"
                           ],
                           "Resource": "*",
                           "Effect": "Allow"
                        },
                        {
                           "Action": [
                              "iam:ListRoles",
                              "iam:ListOpenIdConnectProviders",
                              "sns:ListPlatformApplications"
                           ],
                           "Resource": "*",
                           "Effect": "Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "SilvaEngineMicroCoreAIAgentLayer": {
         "Type": "AWS::Lambda::LayerVersion",
         "Properties": {
            "CompatibleRuntimes": [
               "python3.8",
               "python3.9",
               "python3.10",
               "python3.11"
            ],
            "Content": {
               "S3Bucket": null,
               "S3Key": "silvaengine_microcore_ai_agent_layer.zip"
            },
            "Description": "SilvaEngine MicroCore AI Agent Layer",
            "LayerName": "silvaengine_microcore_ai_agent_layer",
            "LicenseInfo": "MIT"
         }
      },
      "SilvaEngineMicroCoreAIAgentLayerPermission": {
         "Type": "AWS::Lambda::LayerVersionPermission",
         "Properties": {
            "Action": "lambda:GetLayerVersion",
            "LayerVersionArn": {
               "Ref": "SilvaEngineMicroCoreAIAgentLayer"
            },
            "Principal": {
               "Ref": "AWS::AccountId"
            }
         }
      },
      "SilvaEngineMicroCoreAIAgent": {
         "Type": "AWS::Lambda::Function",
         "Properties": {
            "FunctionName": "silvaengine_microcore_ai_agent",
            "Handler": "workers.handler",
            "Layers": [
               "silvaengine_layer",
               {
                  "Ref": "SilvaEngineMicroCoreAIAgentLayer"
               }
            ],
            "Role": {
               "Fn::GetAtt": [
                  "SilvaEngineMicroCoreExecRole",
                  "Arn"
               ]
            },
            "Code": {
               "S3Bucket": "silvaengine-aws",
               "S3Key": "silvaengine_microcore_ai_agent.zip"
            },
            "Runtime": "python3.11",
            "Timeout": "900",
            "Environment": {
               "Variables": {
                  "LOGGINGLEVEL": "logging.INFO",
                  "REGIONNAME": "us-west-2"
               }
            },
            "MemorySize": 4096
         },
         "DependsOn": [
            "SilvaEngineMicroCoreExecRole",
            "SilvaEngineMicroCoreAIAgentLayer"
         ]
      }
   }
}